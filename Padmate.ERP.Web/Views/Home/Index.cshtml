@using Padmate.ERP.Models;
@using Padmate.ERP.Utility;
@{
    Layout = null;    
    var user = Session[Common.SessionLoginUser] != null ? (M_User)Session[Common.SessionLoginUser] : null;

}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台</title>
    <link rel="shortcut icon" href="~/images/favicon.png" />

    <link rel="stylesheet" href="~/Content/bootstrap.css">
    <link rel="stylesheet" href="~/Content/font-awesome.min.css">

    <!-- Custom styles for our template -->

    <link rel="stylesheet" href="~/Content/main.css">
    <link rel="stylesheet" href="~/Content/animate.css">
    <link rel="stylesheet" href="~/Content/admin.css">
    <link rel="stylesheet" href="~/Content/admin-skin.css">

    <link rel="stylesheet" href="~/Content/Common.css">
    <link rel="stylesheet" href="~/fonts/font-awesome/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <link href="~/Resources/extjs-4.2.1/resources/ext-theme-neptune/ext-theme-neptune-all.css" rel="stylesheet" />
    
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Resources/extjs-4.2.1/bootstrap.js"></script>
   
</head>
<body class="skin-blue">

    <div id="adminHeadArea">

        <header class="main-header">
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <div style="float:left">
                    <a href="/" class="logo">
                        <span class="logo-lg"> HardaGroup ERP</span>
                    </a>
                </div>
                
                <div class="navbar-header navbar-toggle-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>

                <div class="collapse navbar-collapse navbar-custom-menu" id="navbar-collapse">
                    <ul class="nav navbar-nav">

                        <!-- Messages: style can be found in dropdown.less-->
                        <li class="dropdown messages-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-envelope-o"></i>
                                <span class="label label-success">4</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="header">You have 4 messages</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu">
                                        <li>
                                            <!-- start message -->
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Support Team
                                                    <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <!-- end message -->
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    AdminLTE Design Team
                                                    <small><i class="fa fa-clock-o"></i> 2 hours</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Developers
                                                    <small><i class="fa fa-clock-o"></i> Today</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Sales Department
                                                    <small><i class="fa fa-clock-o"></i> Yesterday</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Reviewers
                                                    <small><i class="fa fa-clock-o"></i> 2 days</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="footer"><a href="#">See All Messages</a></li>
                            </ul>
                        </li>
                        <!-- Notifications: style can be found in dropdown.less -->
                        <li class="dropdown notifications-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-bell-o"></i>
                                <span class="label label-warning">10</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="header">You have 10 notifications</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu">
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-users text-aqua"></i> 5 new members joined today
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-warning text-yellow"></i> Very long description here that may not fit into the
                                                page and may cause design problems
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-users text-red"></i> 5 new members joined
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-shopping-cart text-green"></i> 25 sales made
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-user text-red"></i> You changed your username
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="footer"><a href="#">View all</a></li>
                            </ul>
                        </li>
                        <!-- Tasks: style can be found in dropdown.less -->
                        <li class="dropdown tasks-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-flag-o"></i>
                                <span class="label label-danger">9</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="header">You have 9 tasks</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu">
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Design some buttons
                                                    <small class="pull-right">20%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">20% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Create a nice theme
                                                    <small class="pull-right">40%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-green" style="width: 40%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">40% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Some task I need to do
                                                    <small class="pull-right">60%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-red" style="width: 60%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">60% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Make beautiful transitions
                                                    <small class="pull-right">80%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-yellow" style="width: 80%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">80% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                    </ul>
                                </li>
                                <li class="footer">
                                    <a href="#">View all tasks</a>
                                </li>
                            </ul>
                        </li>
                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">

                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="~/images/loginuser.jpg" class="user-image" alt="User Image">
                                <span class="hidden-xs">
                                    @user.UserName
                                </span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">

                                    <p>
                                        欢迎登录ERP - @user.UserName
                                        <small>@DateTime.Now</small>
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                    <div class="row">
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Followers</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Sales</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Friends</a>
                                        </div>
                                    </div>
                                    <!-- /.row -->
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="javaScript:void(0)" onclick="ChangePassword();" class="btn btn-default btn-flat">更改密码</a>
                                    </div>
                                    <div class="pull-right">
                                        @using (Html.BeginForm("SignOut", "Account", FormMethod.Post, new { id = "logoutForm" }))
                                        {
                                        <a href="javascript:document.getElementById('logoutForm').submit()" class="btn btn-default btn-flat">注销</a>

                                        }

                                    </div>
                                </li>
                            </ul>

                        </li>

                    </ul>
                </div>
            </nav>
        </header>
    </div>
    <div id="adminContentArea"></div>
    
    <script>

        
        var tabPanel;
        var treePanel;
        Ext.onReady(function () {
            var store = Ext.create('Ext.data.TreeStore', {
                root: {
                    expanded: true,
                    text:'root'
                },
                proxy: {
                    type: 'ajax',
                    //url: '../tree-data.json'
                    actionMethods: {
                        create: 'POST',
                        read: 'POST', // by default GET
                        update: 'POST',
                        destroy: 'POST'
                    },
                    url: '/Home/LoadTreeData'
                }
            });

            // Go ahead and create the TreePanel now so that we can use it below
            treePanel = Ext.create('Ext.tree.Panel', {
                id: 'tree-panel',
                region: 'north',
                split: true,
                height: '100%',
                minSize: 150,
                rootVisible: false,
                autoScroll: true,
                store: store,
                useArrows:true,
                listeners: {
                    //单击展开收缩
                    itemclick: function (view, node) {
                        if (node.isLeaf()) {
                            //子节点，则打开对应的tab页
                            var nodeId = node.data.id;
                            var nodeText = node.data.text;
                            //如果tab页已经打开，则激活该页面
                            if (Ext.getCmp(nodeId)) {
                                tabPanel.setActiveTab(nodeId);
                            } else {

                                var iframeSrc = "";
                                if (node.raw != undefined) {
                                    iframeSrc = node.raw.iframesrc;
                                }

                                var config = {
                                    "nodeId": nodeId,
                                    "nodeText": nodeText,
                                    "iframeSrc": iframeSrc
                                }
                                addTab(config);

                            }


                        } else if (node.isExpanded()) {
                            node.collapse();
                        } else {
                            node.expand();
                        }
                    }
                }
            });

            // Assign the changeLayout function to be called on tree node click.
            treePanel.getSelectionModel().on('select', function (selModel, record) {
                //if (record.get('leaf')) {
                //    debugger;
                //    var id = record.getId();
                //    //如果存在当前选项卡，则激活当前选项卡，否则创建选项卡
                //    if (Ext.getCmp(id)) {
                //        tabPanel.setActiveTab(id);
                        

                //    } else {
                //        addTab(id, "/Home/Contact");

                //    }
                   
                //}
            });
            var currentItem;
            tabPanel = Ext.create('Ext.tab.Panel', {
                id:'content-tabpanel',
                tabPosition: 'top',
                activeTab: 0,
                height: '100%',
                width: '100%',
                autoScroll: true,
                defaults: {
                    bodyPadding: 0
                },
                //items: [
                //  {
                //      title: '首 页',
                //      html: 'asdf'
                //  }
                //]
            });

            //添加首页
            var config = {
                "nodeText": "首页",
                "iframeSrc": "/Home/IndexHome",
                "closable":false
            }
            addTab(config);

            Ext.create('Ext.Viewport', {
                layout: 'border',
                title: 'Ext Layout Browser',
                items: [{
                    xtype: 'box',
                    id: 'header',
                    region: 'north',
                    html: $("#adminHeadArea").html(),
                    height: 50
                }, {
                    layout: 'border',  //指定边框
                    id: 'layout-browser',
                    title: '供应商',
                    region: 'west',
                    collapsible: true,
                    listeners:{
                        'collapse': function(node,e){
                            ResizeContentTabPanel();
                        }
                    },
                    margin:'0 0 0 0',
                    border: false,
                    split: true,
                    width:230,
                    minSize: 100,
                    maxSize: 500,
                    items:treePanel
                },
                {
                    id: 'content-panel',
                    layout: 'fit',
                    region: 'center',
                    margins: '0 0 3 1',
                    items: tabPanel
                }
                ],
                renderTo: Ext.getBody()
            });

            window.onresize = function () {
                WindowsResize();
                ResizeContentTabPanel();
            };
        });

        function addTab(config) {

            if (config != null)
            {
                var nodeId = config.nodeId == null ? "" : config.nodeId;
                var nodeText = config.nodeText == null ? "" : config.nodeText;
                var iframeSrc = config.iframeSrc == null ? "" : config.iframeSrc;
                var closable = (config.closable == null || config.closeable == "") ? true : false;

                var iframeId = "iframe" + nodeId;
                var dynamicTabHtml = "<iframe id='" + iframeId + "' src='" + iframeSrc + "' width='100%' height='100%'  frameborder=0 ></iframe>";

                tabPanel.add({
                    closable: closable,
                    id: nodeId,
                    itemId: nodeId,
                    html: dynamicTabHtml,
                    title: nodeText,
                    //loader:{ url: "/Home/Contact",autoLoad:true, scripts:true},
                    tabConfig: {
                        //双击关闭tab
                        listeners: {
                            element: 'el',
                            dblclick: function () {
                                if(nodeId != null && nodeId !="")
                                {
                                    tabPanel.remove(Ext.getCmp(nodeId));
                                    //取消tab页的同时，判断左边选中的树节点是否与当前取消的tab页对应，如果对应则同时取消
                                    //树节点的选中状态
                                    var selectTreeNodes = treePanel.getSelectionModel().getSelection();
                                    for (var i = 0; i < selectTreeNodes.length; i++) {

                                        if (nodeId == selectTreeNodes[i].internalId) {
                                            treePanel.getSelectionModel().deselect(selectTreeNodes[i]);
                                        }
                                    }

                                }
                                
                            }
                        }
                    }
                }).show();
            }
            
            
        }

        

        //宽高自适应
        //480 768 992 1200 
        function WindowsResize()
        {
            var currentScreenWidth = document.body.clientWidth; ;
            if(currentScreenWidth <767)
            {
                Ext.getCmp("layout-browser").collapse(Ext.Component.DIRECTION_LEFT, true);
            } else {
                Ext.getCmp("layout-browser").expand(true);

            }
            
        }

        function ResizeContentTabPanel()
        {
            Ext.getCmp("content-tabpanel").setHeight(Ext.getCmp("content-panel").getHeight());
            Ext.getCmp("content-tabpanel").setWidth(Ext.getCmp("content-panel").getWidth());
        }

        function ChangePassword()
        {
            var nodeId = "changepassword";
            var nodeText = "修改密码";
            var iframeSrc = "/Account/ChangePassword";
            //更改密码
            var config = {
                "nodeId":nodeId,
                "nodeText":nodeText,
                "iframeSrc":iframeSrc
            }
            addTab(config);
        }
    </script>

</body>
</html>


