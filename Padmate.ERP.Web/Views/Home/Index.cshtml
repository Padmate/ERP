@using Padmate.ERP.Models;
@using Padmate.ERP.Utility;
@{
    Layout = null;    
    var user = Session[Common.SessionLoginUser] != null ? (M_User)Session[Common.SessionLoginUser] : null;

}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台</title>
    <link rel="shortcut icon" href="~/images/favicon.png" />

    <link rel="stylesheet" href="~/Content/bootstrap.css">
    <link rel="stylesheet" href="~/Content/font-awesome.min.css">

    <!-- Custom styles for our template -->

    <link rel="stylesheet" href="~/Content/main.css">
    <link rel="stylesheet" href="~/Content/animate.css">
    <link rel="stylesheet" href="~/Content/admin.css">
    <link rel="stylesheet" href="~/Content/admin-skin.css">

    <link rel="stylesheet" href="~/Content/Common.css">
    <link rel="stylesheet" href="~/fonts/font-awesome/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <link href="~/Resources/extjs-4.2.1/resources/ext-theme-neptune/ext-theme-neptune-all.css" rel="stylesheet" />
    
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Resources/extjs-4.2.1/bootstrap.js"></script>
   
</head>
<body class="skin-blue">

    <div id="adminHeadArea">
        <header class="main-header">
            <a href="/" class="logo">
                <span class="logo-lg"> HardaGroup ERP</span>
            </a>
            <nav class="navbar navbar-static-top">
                

                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">

                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">

                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="~/images/loginuser.jpg" class="user-image" alt="User Image">
                                <span class="hidden-xs">
                                    @user.UserName
                                </span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img src="~/images/loginuser.jpg" class="img-circle" alt="User Image">

                                    <p>
                                        欢迎登录ERP - @user.UserName
                                        <small>@DateTime.Now</small>
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                    <div class="row">
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Followers</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Sales</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Friends</a>
                                        </div>
                                    </div>
                                    <!-- /.row -->
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="#" class="btn btn-default btn-flat">个人资料</a>
                                    </div>
                                    <div class="pull-right">
                                        @using (Html.BeginForm("SignOut", "Account", FormMethod.Post, new { id = "logoutForm" }))
                                        {
                                            <a href="javascript:document.getElementById('logoutForm').submit()" class="btn btn-default btn-flat">注销</a>

                                        }

                                    </div>
                                </li>
                            </ul>

                        </li>

                    </ul>
                </div>
            </nav>
        </header>
    </div>
    <div id="adminContentArea"></div>
    
    <script>

        
        var tabPanel;
        var treePanel;
        Ext.onReady(function () {
            var store = Ext.create('Ext.data.TreeStore', {
                root: {
                    expanded: true
                },
                proxy: {
                    type: 'ajax',
                    url: '../tree-data.json'
                }
            });

            // Go ahead and create the TreePanel now so that we can use it below
            treePanel = Ext.create('Ext.tree.Panel', {
                id: 'tree-panel',
                region: 'north',
                split: true,
                height: '100%',
                minSize: 150,
                rootVisible: false,
                autoScroll: true,
                store: store
            });

            // Assign the changeLayout function to be called on tree node click.
            treePanel.getSelectionModel().on('select', function (selModel, record) {
                if (record.get('leaf')) {
                    
                    var id = record.getId();
                    //如果存在当前选项卡，则激活当前选项卡，否则创建选项卡
                    if (Ext.getCmp(id)) {
                        tabPanel.setActiveTab(id);
                        

                    } else {
                        addTab(id);

                    }
                   
                }
            });
            var currentItem;
            tabPanel = Ext.create('Ext.tab.Panel', {
                id:'content-tabpanel',
                tabPosition: 'top',
                activeTab: 0,
                height: '100%',
                width: '100%',
                autoScroll: true,
                defaults: {
                    bodyPadding: 0
                },
                items: [
                  {
                      title: '首 页',
                      html: 'asdf'
                  }
                ]
            });

            Ext.create('Ext.Viewport', {
                layout: 'border',
                title: 'Ext Layout Browser',
                items: [{
                    xtype: 'box',
                    id: 'header',
                    region: 'north',
                    html: $("#adminHeadArea").html(),
                    height: 50
                }, {
                    layout: 'border',  //指定边框
                    id: 'layout-browser',
                    title: '供应商',
                    region: 'west',
                    collapsible: true,
                    listeners:{
                        'collapse': function(node,e){
                            ResizeContentTabPanel();
                        }
                    },
                    margin:'0 0 0 0',
                    border: false,
                    split: true,
                    width:230,
                    minSize: 100,
                    maxSize: 500,
                    items:treePanel
                },
                {
                    id: 'content-panel',
                    layout: 'fit',
                    region: 'center',
                    margins: '0 0 3 1',
                    items: tabPanel
                }
                ],
                renderTo: Ext.getBody()
            });

            window.onresize = function () {
                WindowsResize();
                ResizeContentTabPanel();
            };
        });

        function addTab(clickItemId) {

            var iframeId = clickItemId + "Iframe";
            var dynamicTabHtml = "<iframe id='" + iframeId + "' src='/Home/Contact' width='100%' height='100%'  frameborder=0 ></iframe>";
            tabPanel.add({
                closable: true,
                id: clickItemId,
                itemId: clickItemId,
                html: dynamicTabHtml,
                title: clickItemId,
                //loader:{ url: "/Home/Contact",autoLoad:true, scripts:true},
                tabConfig: {
                    //双击关闭tab
                    listeners: {
                        element: 'el',
                        dblclick: function () {
                            tabPanel.remove(Ext.getCmp(clickItemId));
                            //取消tab页的同时，判断左边选中的树节点是否与当前取消的tab页对应，如果对应则同时取消
                            //树节点的选中状态
                            var selectTreeNodes = treePanel.getSelectionModel().getSelection(); 
                            for (var i = 0; i < selectTreeNodes.length; i++) {
                                
                                if (clickItemId == selectTreeNodes[i].internalId)
                                {
                                    treePanel.getSelectionModel().deselect(selectTreeNodes[i]);
                                }
                            }

                        }
                    }
                }
            }).show();
        }

        

        //宽高自适应
        //480 768 992 1200 
        function WindowsResize()
        {
            var currentScreenWidth = document.body.clientWidth; ;
            if(currentScreenWidth <767)
            {
                Ext.getCmp("layout-browser").collapse(Ext.Component.DIRECTION_LEFT, true);
            } else {
                Ext.getCmp("layout-browser").expand(true);

            }
            
        }

        function ResizeContentTabPanel()
        {
            Ext.getCmp("content-tabpanel").setHeight(Ext.getCmp("content-panel").getHeight());
            Ext.getCmp("content-tabpanel").setWidth(Ext.getCmp("content-panel").getWidth());
        }
    </script>

</body>
</html>


